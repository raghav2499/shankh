SELECT SUM(ord_amt.total_amount) AS totalAmount, DATE_TRUNC('week', ord.created_at) AS week "
FROM orders ord "
INNER JOIN order_amount ord_amt ON ord.id = ord_amt.order_id "
INNER JOIN order_item ord_ite ON ord.id = ord_ite.order_id "
WHERE ord.boutique_id = :boutiqueId "
AND ord.created_at >= :startDate "
AND ord.created_at < :endDate "
AND ord.is_deleted != true "
AND ord.status != 0 "
AND ord_ite.status != 6 "
GROUP BY DATE_TRUNC('week', ord.created_at) ORDER BY DATE_TRUNC('week', ord.created_at)", nativeQuery = true)
